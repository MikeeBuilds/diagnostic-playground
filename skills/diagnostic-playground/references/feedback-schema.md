# Feedback Schema Reference

Structured format for tester feedback. The dashboard's "Copy Feedback" button produces this exact format.

## Feedback Output Format

When a tester clicks "Copy Feedback", the clipboard receives this structured text block:

```
=== DIAGNOSTIC FEEDBACK ===
Template: {template-name}
Data queried at: {ISO timestamp}
Generated by: diagnostic-playground plugin

--- FINDINGS ---

[Finding 1]
Category: {bug | data-issue | missing-analytics | question}
Severity: {critical | high | medium | low}
Description: {tester's description}
Affected IDs: {comma-separated IDs if referenced}
Data context: {relevant row data or summary stats}

[Finding 2]
...

--- SESSION CONTEXT ---
Filters applied: {list of active filters}
Rows visible: {count of displayed rows}
Total rows: {count of all rows}

--- ACTION REQUEST ---
Please investigate the findings above. For each:
- bug: identify the code path and propose a fix
- data-issue: write a migration or SQL fix
- missing-analytics: add the tracking event to the relevant component
- question: research and answer with supporting data

=== END FEEDBACK ===
```

## Category Definitions

| Category | When to use | Claude's expected action |
|----------|-------------|------------------------|
| `bug` | Something is broken — wrong data, failed operation, UI mismatch | Investigate code, propose fix, optionally file an issue |
| `data-issue` | Data inconsistency — mismatched counts, orphaned records, drift | Write SQL migration or RPC to fix, verify with fresh query |
| `missing-analytics` | Event should be tracked but isn't | Add tracking event to the relevant view/component |
| `question` | Unclear behavior — needs investigation, not necessarily a bug | Research the code/data, provide explanation with evidence |

## Severity Definitions

| Severity | Meaning |
|----------|---------|
| `critical` | Data loss, security issue, or completely broken feature |
| `high` | Feature doesn't work correctly for many users |
| `medium` | Noticeable issue but has workaround |
| `low` | Cosmetic or edge case |

## JavaScript Implementation

The feedback panel should maintain findings in an array and serialize on copy:

```javascript
const findings = [];

function addFinding(category, severity, description, affectedIds = [], dataContext = '') {
  findings.push({
    id: findings.length + 1,
    category,
    severity,
    description,
    affectedIds,
    dataContext,
    timestamp: new Date().toISOString()
  });
  renderFindings();
}

function serializeFeedback() {
  const meta = DATA._meta;
  let output = `=== DIAGNOSTIC FEEDBACK ===\n`;
  output += `Template: ${meta.template}\n`;
  output += `Data queried at: ${meta.queriedAt}\n`;
  output += `Generated by: diagnostic-playground plugin\n\n`;
  output += `--- FINDINGS ---\n\n`;

  findings.forEach((f, i) => {
    output += `[Finding ${i + 1}]\n`;
    output += `Category: ${f.category}\n`;
    output += `Severity: ${f.severity}\n`;
    output += `Description: ${f.description}\n`;
    if (f.affectedIds.length) output += `Affected IDs: ${f.affectedIds.join(', ')}\n`;
    if (f.dataContext) output += `Data context: ${f.dataContext}\n`;
    output += `\n`;
  });

  output += `--- SESSION CONTEXT ---\n`;
  output += `Filters applied: ${getActiveFilters().join(', ') || 'none'}\n`;
  output += `Rows visible: ${getVisibleRowCount()}\n`;
  output += `Total rows: ${getTotalRowCount()}\n\n`;

  output += `--- ACTION REQUEST ---\n`;
  output += `Please investigate the findings above. For each:\n`;
  output += `- bug: identify the code path and propose a fix\n`;
  output += `- data-issue: write a migration or SQL fix\n`;
  output += `- missing-analytics: add the tracking event to the relevant component\n`;
  output += `- question: research and answer with supporting data\n\n`;
  output += `=== END FEEDBACK ===`;

  return output;
}

function copyFeedback() {
  const text = serializeFeedback();
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy Feedback'; }, 2000);
  });
}
```

## Finding Card HTML Pattern

Each finding in the panel should render as:

```html
<div class="finding-card" data-severity="{severity}">
  <div class="finding-header">
    <span class="finding-badge finding-badge--{category}">{category}</span>
    <span class="finding-severity finding-severity--{severity}">{severity}</span>
  </div>
  <p class="finding-desc">{description}</p>
  {#if affectedIds.length}
  <div class="finding-ids">IDs: {affectedIds.join(', ')}</div>
  {/if}
</div>
```
